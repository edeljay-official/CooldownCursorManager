local function ApplyUFBigHBOverlayHealthColor(o, hp)
    if not o or not o.healthTex or not hp or not hp.GetStatusBarColor then return end
    if not o or not o.healthFrame or not hp or not hp.GetStatusBarColor then return end
    local r, g, b = hp:GetStatusBarColor()
    end
    o.healthTex:SetVertexColor(r, g, b, 1)
    if o.healthFrame.SetStatusBarColor then
      o.healthFrame:SetStatusBarColor(r, g, b, 1)
    end
    local st = o.healthFrame.GetStatusBarTexture and o.healthFrame:GetStatusBarTexture()
    if st and st.SetVertexColor then
      st:SetVertexColor(r, g, b, 1)
    end
  end
  local function SyncUFBigHBOverlayValue(o, hp)
    if not o or not o.healthFrame or not hp then return end
    if hp.GetMinMaxValues and o.healthFrame.SetMinMaxValues then
      local minValue, maxValue = hp:GetMinMaxValues()
      pcall(o.healthFrame.SetMinMaxValues, o.healthFrame, minValue, maxValue)
    end
    if hp.GetValue and o.healthFrame.SetValue then
      local curValue = hp:GetValue()
      pcall(o.healthFrame.SetValue, o.healthFrame, curValue)
    end
    local srcTex = hp.GetStatusBarTexture and hp:GetStatusBarTexture()
    local dstTex = o.healthFrame.GetStatusBarTexture and o.healthFrame:GetStatusBarTexture()
    if srcTex and dstTex and srcTex.GetTexCoord and dstTex.SetTexCoord then
      local ulx, uly, llx, lly, urx, ury, lrx, lry = srcTex:GetTexCoord()
      pcall(dstTex.SetTexCoord, dstTex, ulx, uly, llx, lly, urx, ury, lrx, lry)
    end
  end
  local function EnsureUFBigHBOverlay(key, parent)
    local o = State.ufBigHBOverlays[key]
    if o and o.healthFrame and o.healthFrame.GetObjectType and o.healthFrame:GetObjectType() ~= "StatusBar" then
      if o.healthFrame.Hide then o.healthFrame:Hide() end
      o.healthFrame = nil
      o.healthTex = nil
    end
    if not o then
      o.bgTex:SetAllPoints(o.bgFrame)
      o.healthFrame = CreateFrame("Frame", nil, parent)
      o.healthTex = o.healthFrame:CreateTexture(nil, "ARTWORK")
      o.healthTex:SetAllPoints(o.healthFrame)
      o.healthFrame = CreateFrame("StatusBar", nil, parent)
      o.healthFrame:SetMinMaxValues(0, 1)
      o.healthFrame:SetValue(1)
      o.healthFrame:SetStatusBarTexture("Interface\\Buttons\\WHITE8x8")
      o.healthTex = o.healthFrame:GetStatusBarTexture()
      if o.healthTex and o.healthTex.SetAllPoints then
        o.healthTex:SetAllPoints(o.healthFrame)
      end
      State.ufBigHBOverlays[key] = o
    end
    if key == "target" then
      enabled = enabled and UnitExists("target")
    elseif key == "focus" then
      enabled = enabled and UnitExists("focus")
    elseif string.find(key, "boss", 1, true) == 1 then
      local bossIndex = tonumber(string.match(key or "", "^boss(%d+)$"))
      enabled = enabled and bossIndex and UnitExists("boss" .. bossIndex)
    end
    local contextual = (key == "player" and rootFrame and rootFrame.Contextual) or nil
    o.bgTex:SetVertexColor(bBright, bBright, bBright, 1)
    o.healthTex:SetTexture(healthPath)
    if o.healthFrame.SetStatusBarTexture then
      o.healthFrame:SetStatusBarTexture(healthPath)
    end
    o.healthTex = o.healthFrame.GetStatusBarTexture and o.healthFrame:GetStatusBarTexture() or o.healthTex
    if o.healthTex and o.healthTex.SetAllPoints then
      o.healthTex:SetAllPoints(o.healthFrame)
    end
    SyncUFBigHBOverlayValue(o, hp)
    ApplyUFBigHBOverlayHealthColor(o, hp)
          SetUFBaseHealthBarCovered(ov, hpBar, true, root and root.HealthBarsContainer, root)
          SyncUFBigHBOverlayValue(ov, hpBar)
          ApplyUFBigHBOverlayHealthColor(ov, hpBar)